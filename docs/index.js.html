<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env node
/**
 * @author Samuel Antoine
 */
const clear = require('clear');
const project = require('./utils/New');
const files = require('./lib/files');
const yargs = require('yargs');
const chalk = require('chalk');
const path = require('path');
const commands = require('./utils/execShellCommands');
const test = require('./utils/tests');
const inquirer = require('./lib/inquirer');
const sql = require('./generate/database/sqlAdaptator');
const reserved = require('reserved-words');
const Log = require('./generate/log')
const utils = require('./generate/utils');
 
const validateDirectory = ()=>{
  if(!files.isProjectDirectory()){
    console.log(chalk.bgRed(chalk.black('ERROR ! : You are not in a project directory')));
    process.exit(0);
  }
}
yargs
.strict()
  .command({
    command: 'new',
    aliases: ['n'],
    desc: 'Generate a new project',
    builder: (yargs) => {
      yargs.option('env',{
        desc: "Allow user to specify ENV variables",
        type: "boolean"
      }),
      yargs.option('path',{
        desc: "Allow the user to choose a different path",
        type: 'boolean'
      }),
      yargs.option('docker',{
        desc: "Set a mysql container up",
        type: 'boolean'
      })
    },
    handler: async(argv) => {
      clear();
      if(argv._[1] === undefined){
        console.log(chalk.red('Please provide a name for your application'));
        process.exit(0);
      }
      project.New(argv._[1],argv.env !== undefined ? true: false, argv.path != undefined ? true: false,argv.docker != undefined ? true: false );
    }
  }).command({
    strict: true,
    command: 'test',
    aliases: ['t'],
    desc: 'Execute unit tests',
    builder: (yargs) => {
      yargs.option('logs', {
        desc: "Show the full output",
        type: 'boolean'
      })
    },
    handler: async (argv) => {
      validateDirectory();
      await sql.checkConnexion();
      test.execUnitTests(argv.logs !== undefined ? true : false);
    }
  })
  .command({
    command: 'generate &lt;modelName> [CRUD]',
    aliases: ['gen', 'g'],
    desc: 'Generate a new model',
    builder: (yargs) => {
      yargs.default('CRUD', 'CRUD');
    },
    handler: async (argv) => {
      validateDirectory();
      await sql.checkConnexion();
      if (await reserved.check(argv.modelName,6)){
        console.log("modelName is a reserved word");
        process.exit(0);
      }
      commands.generateModel(argv.modelName,argv.CRUD);
    }
  })
  .command({
    command: 'import',
    aliases: ["imp"],
    desc: "Generate all the files from existing tables in the databse",
    builder: () => {},
    handler: async () => {
      validateDirectory();
      check = await sql.checkConnexion();
      commands.generateFromDB();
    }
  })
  .command({
    command: 'delete &lt;modelName>',
    aliases: ['del', 'D'],
    drop: false,
    desc: 'Generate a new model',
    builder: (yargs) => {
      yargs.option({
        DROP :{
          default:false,
          type: 'boolean'
        }
      })
    },
    handler: async (argv) => {
      validateDirectory();
      if(argv.DROP)await sql.checkConnexion();
      commands.deleteModel(argv.modelName,argv.DROP);
    }
  })
  .command({
    command: 'info',
    aliases: ['i'],
    desc: 'Show the information about the developers',
    builder: () => {},
    handler: () => {
      console.log(chalk.bgGreen('Made by :')+ "\n Amaury Deflorenne &lt;https://github.com/AmauryD> \n Romain Verliefden &lt;https://github.com/DramixDW> \n Samuel Antoine &lt;https://github.com/Snorkell> \n Steve Lebleu &lt;https://github.com/konfer-be>");
      process.exit(0);
    }
  })
  .command({
    command:"start",
    aliases : [],
    desc: "Start the api server",
    builder: (yargs) =>{
      yargs.option('env',{
        desc: "Specify the environement type",
        type: "string"
      })
    },
    handler: async(argv) => {
      validateDirectory();
      let environement = argv.env !== undefined ? argv.env : "development";
      if(environement.toLowerCase() === ('development') || environement.toLowerCase() === ('staging') || environement.toLowerCase() === ('test') ||environement.toLowerCase() === ('production')){
        console.log(chalk.bgYellow(chalk.black('To quit the process press CTRL+C and validate')));
        await commands.compileTypeScript();
        commands.startServer(environement);
      }else{
        console.log(chalk.red(`${environement} is not a valid environement`))
        process.exit(0);
      }
    }
  })
  .command({
    command:'migrate  &lt;migrateName>',
    aliases: ["mig", "M"],
    desc: "Generate, compile and run the migration",
    builder: () => {},
    handler: async (argv) => {
      validateDirectory();
      await sql.checkConnexion();
      if (await reserved.check(argv.modelName,6)){
        console.log("modelName is a reserved word");
        process.exit(0);
      }
      commands.migrate(argv.migrateName);
    }
  })
  .command({
    command:'createSU &lt;username>',
    aliases: ['csu'],
    desc: "Create a Super User and save the credentials in a file",
    builder: () => {},
    handler: async(argv) => {
      validateDirectory();
      await sql.checkConnexion();
      commands.createSuperUser(argv.username);
    }
  })
  .command({
    command:'addRelationship &lt;relation> &lt;model1> &lt;model2>',
    aliases:['ar','addR'],
    desc: 'Create  relation between two table',
    builder : () => {},
    handler : (argv) =>{
      if(!utils.modelFileExists(argv.model1) || !utils.modelFileExists(argv.model2) ){
        Log.error("Both model should exist in order to create a many to many relationship :)");
        process.exit(0);
      } 
     commands.createRelation(argv.model1,argv.model2,argv.relation);
    }
  })
  .command({
    command:'editModel &lt;model> [column]',
    aliases: ["em", "edit"],
    desc: 'add or remove column in a model',
    builder : (yargs) => {
      yargs.option({
        add :{
          default:false,
          type: 'boolean'
        },
        remove :{
          default:false,
          type: 'boolean'
        }
      })
    },
    handler : (argv) =>{
      if(!utils.modelFileExists(argv.model)){
        Log.error("Model should exist in order to edit him :)");
        process.exit(0);
      } 
      if (argv.add &amp;&amp; !argv.remove)commands.editModel('add',argv.model);
      else if (argv.remove &amp;&amp; !argv.add &amp;&amp; argv.column != undefined )commands.editModel('remove',argv.model,argv.column);
      else Log.info("both flag can't be activated at the same time");
    }
  })
  // provide a minimum demand and a minimum demand message
  .demandCommand(1, 'You need at least one command before moving on')
  .help().scriptName('nfw')
  .argv;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-commands.html">commands</a></li><li><a href="module-databaseInfo.html">databaseInfo</a></li><li><a href="module-delete.html">delete</a></li><li><a href="module-draw.html">draw</a></li><li><a href="module-ErrorHandler.html">ErrorHandler</a></li><li><a href="module-files.html">files</a></li><li><a href="module-generateFromDB.html">generateFromDB</a></li><li><a href="module-index.html">index</a></li><li><a href="module-inquirer.html">inquirer</a></li><li><a href="module-modelSpecs.html">modelSpecs</a></li><li><a href="module-modelWrite.html">modelWrite</a></li><li><a href="module-New.html">New</a></li><li><a href="module-sqlAdapatator.html">sqlAdapatator</a></li><li><a href="module-test.html">test</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-delete.html">delete</a></li></ul><h3>Global</h3><ul><li><a href="global.html#chalk">chalk</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#databaseEnv">databaseEnv</a></li><li><a href="global.html#dotenv">dotenv</a></li><li><a href="global.html#FS">FS</a></li><li><a href="global.html#inquirer">inquirer</a></li><li><a href="global.html#items">items</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Mar 29 2019 11:09:40 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
