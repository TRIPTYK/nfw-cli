<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: generate/database/mongoAdaptator.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: generate/database/mongoAdaptator.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * [WIP]
 */

const databaseEnv = require('./databaseEnv');
const dotenv = require('dotenv');
const { promisify } = require('es6-promisify');
const mongodb = require('mongodb');
const MongoClient = mongodb.MongoClient;

const Log = require('../log');
const url = `mongodb://${databaseEnv.user}:${databaseEnv.pwd}@${databaseEnv.host}:${databaseEnv.port}`;

const client = new MongoClient();
const Connect = promisify(MongoClient.connect);

exports.getColumns = async (tableName) => {
  const connection = await Connect(url,{ useNewUrlParser: true });
  const db = connection.db(databaseEnv.database);
  const collection = db.collection(tableName);
  const FindOne = promisify(collection.findOne.bind(collection));

  // make new Promise manually , and wait for mapReduce result
  const reduceResult = await new Promise(async(resolve,reject) => {
      collection.mapReduce(
        function() {for (var key in this) { emit(key, this ); }}, // emit
        function(key, stuff) { return null },
        {
            query:{},
            out: { inline: 1 }
        },
        function(err, results) {
            if (err) reject(err);
            resolve(results);
        }
      );
  });

  if (Object.keys(reduceResult).length === 0) {
    throw `Cannot detect data type of your mongodb table (${tableName})`;
  }

  let columns = {};

  for (let variable in reduceResult) {
    let column = reduceResult[variable]._id;
    columns[column] = { $exists : true };
  }

  const columnsWithValues = await FindOne(columns);
  columns = {};

  for (let variable in reduceResult) {
    let column = reduceResult[variable]._id;
    let columnValue = columnsWithValues[column];
    columns[column] = {
      Field : column,
      Default : null,
      Type : columnsWithValues[column].constructor.name
    };
  }

  return columns;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-commands.html">commands</a></li><li><a href="module-databaseInfo.html">databaseInfo</a></li><li><a href="module-delete.html">delete</a></li><li><a href="module-draw.html">draw</a></li><li><a href="module-ErrorHandler.html">ErrorHandler</a></li><li><a href="module-files.html">files</a></li><li><a href="module-generateFromDB.html">generateFromDB</a></li><li><a href="module-index.html">index</a></li><li><a href="module-inquirer.html">inquirer</a></li><li><a href="module-modelSpecs.html">modelSpecs</a></li><li><a href="module-modelWrite.html">modelWrite</a></li><li><a href="module-New.html">New</a></li><li><a href="module-sqlAdapatator.html">sqlAdapatator</a></li><li><a href="module-test.html">test</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-delete.html">delete</a></li></ul><h3>Global</h3><ul><li><a href="global.html#chalk">chalk</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#databaseEnv">databaseEnv</a></li><li><a href="global.html#dotenv">dotenv</a></li><li><a href="global.html#FS">FS</a></li><li><a href="global.html#inquirer">inquirer</a></li><li><a href="global.html#items">items</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Mar 29 2019 11:09:40 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
